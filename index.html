<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tasbeeh</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background-color: #dfe7e2; font-family: "Segoe UI", sans-serif; transition: background 0.3s, color 0.3s; }
  .card { border: 2px solid #a3b18a; border-radius: 15px; background: #f4f6f3; transition: background 0.3s, border 0.3s; }
  h1,h4 { color: #4a5d52; }
  .btn-success { background-color: #8aa899; border-color: #8aa899; }
  .btn-success:hover { background-color: #6f8f7d; border-color: #6f8f7d; }
  .progress { background-color: #cbd7d0; }
  .progress-bar { background-color: #8aa899 !important; }

  /* Counter buttons */
  .count-controls { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
  .count-btn { width: 120px; height: 120px; border-radius: 50%; font-size: 2rem; font-weight: bold; display: flex; justify-content: center; align-items: center; border: none; color: white; box-shadow: 0 6px 15px rgba(0,0,0,0.3); transition: transform 0.15s ease-in-out; }
  .count-btn:active { transform: scale(0.95); }
  .count-btn.inc { background-color: #6f8f7d; }
  .count-btn.inc:hover { background-color: #5a7267; transform: scale(1.1); }
  .count-btn.dec { background-color: #a3b18a; }
  .count-btn.dec:hover { background-color: #8f9e76; transform: scale(1.1); }

  .saved-item { background: #f4f6f3; border: 1px solid #a3b18a; border-radius: 10px; padding: 10px 15px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; }
  .saved-item:hover { background-color: #e2ebe6; }
  .badge-sage { background-color: #8aa899; color: white; font-size: 0.9rem; padding: 5px 10px; border-radius: 8px; }

  /* Active highlight */
  .counter-card { transition: box-shadow 0.3s, border-color 0.3s; }
  .counter-card.active { border: 3px solid #6f8f7d; box-shadow: 0 0 15px rgba(111,143,125,0.6); }

  body.dark { background-color: #2f3b35; color: #e6ece8; }
  body.dark .card { background: #3e4a44; border-color: #6f8f7d; }
  body.dark h1,h4 { color: #cdd8d2; }
  body.dark .progress { background-color: #55635d; }
  body.dark .progress-bar { background-color: #a3b18a !important; }
  body.dark .saved-item { background: #3e4a44; border-color: #6f8f7d; }
  body.dark .saved-item:hover { background-color: #4a5d52; }

  @media (max-width: 576px) { .count-btn { width: 90px; height: 90px; font-size: 1.5rem; } }
</style>
</head>
<body class="py-5">
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Tasbeeh</h1>
    <div>
      <button class="btn btn-outline-success me-2" data-bs-toggle="modal" data-bs-target="#savedCountersModal">üíæ Saved Counters</button>
      <button id="theme-toggle" class="btn btn-outline-success">üåô Dark Mode</button>
    </div>
  </div>

  <div class="card shadow-lg p-4 mb-4">
    <div class="row g-2 mb-4">
      <div class="col-md-5">
        <input type="text" id="name" class="form-control border-success" placeholder="Enter name (optional)">
      </div>
      <div class="col-md-5">
        <input type="number" id="goal" class="form-control border-success" placeholder="Enter goal (optional)">
      </div>
      <div class="col-md-2">
        <button id="add-btn" class="btn btn-success w-100">Add</button>
      </div>
    </div>

    <h4>Active Counter</h4>
    <div id="active-counter"></div>
  </div>
</div>

<!-- Saved Counters Modal -->
<div class="modal fade" id="savedCountersModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content" style="border-radius: 12px; border: 2px solid #a3b18a;">
      <div class="modal-header" style="background:#dfe7e2;">
        <h5 class="modal-title text-success">üíæ Saved Counters</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="text" id="searchCounter" class="form-control mb-3" placeholder="üîç Search counters...">
        <div id="saved-counters" class="text-muted">No saved counters yet.</div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Counter Modal -->
<div class="modal fade" id="editCounterModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius:12px; border:2px solid #a3b18a;">
      <div class="modal-header" style="background:#dfe7e2;">
        <h5 class="modal-title text-success">‚úèÔ∏è Edit Counter</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="editName" class="form-label">Name</label>
          <input type="text" id="editName" class="form-control">
        </div>
        <div class="mb-3">
          <label for="editGoal" class="form-label">Goal</label>
          <input type="number" id="editGoal" class="form-control">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success" id="saveEditBtn">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius:12px; border:2px solid #a3b18a;">
      <div class="modal-header" style="background:#dfe7e2;">
        <h5 class="modal-title text-danger">‚ùå Delete Counter</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p id="deleteConfirmText">Are you sure you want to delete this counter?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

<script>
let counters = [], activeIndex = null, editIndex = null, deleteIndex = null;

function loadCounters(){
  const saved = localStorage.getItem("counters");
  counters = saved ? JSON.parse(saved) : [];
  renderActive(); renderSaved();
}

function saveCounters(){ localStorage.setItem("counters", JSON.stringify(counters)); renderSaved(); }

function renderActive(){
  const container = document.getElementById("active-counter");
  container.innerHTML="";
  if(activeIndex===null || counters.length===0){ container.innerHTML=`<p class="text-muted">No active counter selected.</p>`; return; }

  const c=counters[activeIndex];
  const percent=c.goal>0?Math.min((c.count/c.goal)*100,100):0;
  const isGoalReached=c.goal>0 && c.count>=c.goal;

  const counterCard=document.createElement("div");
  counterCard.className="card mb-3 p-3 shadow-sm text-center counter-card active";
  counterCard.tabIndex=0;
  counterCard.innerHTML=`
    <h5 class="mb-2">${c.name} (Goal: ${c.goal>0?c.goal:"‚àû"})</h5>
    <div class="fw-bold mb-2">${c.count}/${c.goal>0?c.goal:"‚àû"}</div>
    <div class="count-controls">
      <button class="count-btn dec" onclick="decrementCounter(${activeIndex})">-1</button>
      <button class="count-btn inc" onclick="incrementCounter(${activeIndex})" ${isGoalReached?"disabled":""}>+1</button>
    </div>
    ${c.goal>0?`<div class="progress my-3" style="height:25px;">
      <div class="progress-bar ${isGoalReached?'bg-success':''}" role="progressbar" style="width:${percent}%">
        ${Math.floor(percent)}%
      </div>
    </div>`:""}
    ${isGoalReached?`<p class="text-success fw-bold">üéâ Goal Reached!</p>`:""}
    <div class="d-flex justify-content-center gap-2 flex-wrap">
      <button class="btn btn-secondary btn-sm" onclick="resetCounter(${activeIndex})">Reset</button>
      <button class="btn btn-warning btn-sm text-dark" onclick="editCounter(${activeIndex})">Edit</button>
      <button class="btn btn-danger btn-sm" onclick="deleteCounter(${activeIndex})">Delete</button>
    </div>
  `;
  container.appendChild(counterCard);
  counterCard.focus();
  
}

function incrementCounter(index){
  const c=counters[index]; if(c.goal>0 && c.count>=c.goal) return;
  counters[index].count++; renderActive(); saveCounters();
}
function decrementCounter(index){ if(counters[index].count>0) counters[index].count--; renderActive(); saveCounters(); }
function resetCounter(index){ counters[index].count=0; renderActive(); saveCounters(); }

function deleteCounter(index){
  deleteIndex=index;
  const counter=counters[index];
  document.getElementById("deleteConfirmText").textContent=`Are you sure you want to delete "${counter.name}"?`;
  const deleteModal=new bootstrap.Modal(document.getElementById("deleteConfirmModal"));
  deleteModal.show();
}

document.getElementById("confirmDeleteBtn").addEventListener("click", () => {
  if (deleteIndex !== null) {
    counters.splice(deleteIndex, 1);

    // Adjust activeIndex
    if (activeIndex === deleteIndex) {
      activeIndex = null; // deleted counter was active
    } else if (activeIndex > deleteIndex) {
      activeIndex--; // shift active index down if after deleted
    }

    renderActive();
    saveCounters();
    deleteIndex = null;
  }
  const modalEl = document.getElementById("deleteConfirmModal");
  const modal = bootstrap.Modal.getInstance(modalEl);
  modal.hide();
});


function editCounter(index){
  editIndex=index;
  const counter=counters[index];
  document.getElementById("editName").value=counter.name;
  document.getElementById("editGoal").value=counter.goal>0?counter.goal:"";
  const editModal=new bootstrap.Modal(document.getElementById("editCounterModal"));
  editModal.show();
}

document.getElementById("saveEditBtn").addEventListener("click",()=>{
  const newName=document.getElementById("editName").value.trim();
  let newGoal=parseInt(document.getElementById("editGoal").value);
  if(newName!=="") counters[editIndex].name=newName;
  if(!isNaN(newGoal)&&newGoal>0) counters[editIndex].goal=newGoal;
  else counters[editIndex].goal=0;
  renderActive(); saveCounters();
  const modalEl=document.getElementById("editCounterModal");
  const modal=bootstrap.Modal.getInstance(modalEl);
  modal.hide();
});

function setActive(index){ activeIndex=index; renderActive(); }

const messageBox=document.createElement("div");
messageBox.className="mt-2 fw-bold text-danger";
document.querySelector(".row.g-2").appendChild(messageBox);

function addCounter(){
  let name=document.getElementById("name").value.trim();
  let goal=parseInt(document.getElementById("goal").value);
  if(!name) name="Untitled"; if(!goal||goal<=0) goal=0;
  messageBox.innerHTML="";
  counters.push({name,goal,count:0});
  activeIndex=counters.length-1; renderActive(); saveCounters();
}

document.getElementById("add-btn").addEventListener("click",addCounter);

document.addEventListener("keydown",(e)=>{
  const activeEl=document.activeElement;
  const isTyping=activeEl.tagName==="INPUT" || activeEl.tagName==="TEXTAREA";

  if(e.key==="ArrowUp" && !isTyping){ e.preventDefault(); if(activeIndex!==null) incrementCounter(activeIndex); }
  if(e.key==="ArrowDown" && !isTyping){ e.preventDefault(); if(activeIndex!==null) decrementCounter(activeIndex); }
  if(e.key==="Enter"){ e.preventDefault(); if(activeEl.id==="name"||activeEl.id==="goal") addCounter(); }
});

document.getElementById("searchCounter").addEventListener("input",(e)=>{
  const searchTerm=e.target.value.toLowerCase();
  document.querySelectorAll("#saved-counters .saved-item").forEach(item=>{
    const text=item.textContent.toLowerCase();
    item.style.display=text.includes(searchTerm)?"flex":"none";
  });
});

function renderSaved(){
  const container=document.getElementById("saved-counters");
  container.innerHTML="";
  if(counters.length===0){ container.innerHTML=`<p class="text-muted">No saved counters yet.</p>`; return; }
  counters.forEach((c,index)=>{
    const item=document.createElement("div");
    item.className="saved-item";
    item.innerHTML=`<span class="fw-bold">${c.name} <span class="badge-sage">${c.count}/${c.goal>0?c.goal:"‚àû"}</span></span>
    <div>
      <button class="btn btn-sm btn-warning text-dark me-2" onclick="event.stopPropagation(); editCounter(${index})">‚úèÔ∏è</button>
      <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteCounter(${index})">‚ùå</button>
    </div>`;
    item.addEventListener("click",()=>setActive(index));
    container.appendChild(item);
  });
}

// Theme toggle
const themeToggle=document.getElementById("theme-toggle");
themeToggle.addEventListener("click",()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");
  themeToggle.textContent=document.body.classList.contains("dark")?"‚òÄÔ∏è Light Mode":"üåô Dark Mode";
});
if(localStorage.getItem("theme")==="dark"){ document.body.classList.add("dark"); themeToggle.textContent="‚òÄÔ∏è Light Mode"; }

loadCounters();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>